# æ—¥ç¨‹åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ å®ç°æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†SpeedCalendaræ—¥ç¨‹ç®¡ç†åŠŸèƒ½çš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬æ•°æ®åº“è®¾è®¡ã€åç«¯æ¥å£å’Œä½¿ç”¨ç¤ºä¾‹ã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ—¥ç¨‹è¡¨ (schedules)

```sql
CREATE TABLE schedules (
    schedule_id VARCHAR(64) NOT NULL COMMENT 'æ—¥ç¨‹å”¯ä¸€ID (UUID)',
    user_id VARCHAR(64) NOT NULL COMMENT 'ç”¨æˆ·ID',
    title VARCHAR(200) NOT NULL COMMENT 'æ—¥ç¨‹æ ‡é¢˜',
    schedule_date DATE NOT NULL COMMENT 'æ—¥ç¨‹æ—¥æœŸ (YYYY-MM-DD)',
    start_time TIME DEFAULT NULL COMMENT 'å¼€å§‹æ—¶é—´ (HH:mm)',
    end_time TIME DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´ (HH:mm)',
    location VARCHAR(200) DEFAULT NULL COMMENT 'æ—¥ç¨‹åœ°ç‚¹',
    is_all_day TINYINT NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦å…¨å¤©ï¼š0-å¦ï¼Œ1-æ˜¯',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    is_deleted TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
    PRIMARY KEY (schedule_id),
    KEY idx_user_id (user_id),
    KEY idx_schedule_date (schedule_date),
    KEY idx_user_date (user_id, schedule_date),
    CONSTRAINT fk_schedules_user FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### è¡¨ç»“æ„è¯´æ˜

- **ä¸»é”®**: `schedule_id` - UUIDæ ¼å¼ï¼Œä¿è¯å…¨å±€å”¯ä¸€
- **å¤–é”®**: `user_id` - å…³è”ç”¨æˆ·è¡¨ï¼Œçº§è”åˆ é™¤
- **ç´¢å¼•ä¼˜åŒ–**:
  - `idx_user_id`: å¿«é€ŸæŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰æ—¥ç¨‹
  - `idx_schedule_date`: æŒ‰æ—¥æœŸæŸ¥è¯¢æ—¥ç¨‹
  - `idx_user_date`: å¤åˆç´¢å¼•ï¼Œä¼˜åŒ–æŒ‰ç”¨æˆ·+æ—¥æœŸèŒƒå›´æŸ¥è¯¢
- **é€»è¾‘åˆ é™¤**: ä½¿ç”¨ `is_deleted` å­—æ®µï¼Œä¸ç‰©ç†åˆ é™¤æ•°æ®

---

## ğŸ”§ åç«¯å®ç°

### 1. å®ä½“ç±» (Schedule.java)

ä½ç½®: `src/main/java/com/example/speedcalendarserver/entity/Schedule.java`

```java
@Entity
@Table(name = "schedules")
public class Schedule {
    private String scheduleId;      // æ—¥ç¨‹ID
    private String userId;          // ç”¨æˆ·ID
    private String title;           // æ—¥ç¨‹æ ‡é¢˜
    private LocalDate scheduleDate; // æ—¥ç¨‹æ—¥æœŸ
    private LocalTime startTime;    // å¼€å§‹æ—¶é—´
    private LocalTime endTime;      // ç»“æŸæ—¶é—´
    private String location;        // åœ°ç‚¹
    private Integer isAllDay;       // æ˜¯å¦å…¨å¤©
    private LocalDateTime createdAt;// åˆ›å»ºæ—¶é—´
    private LocalDateTime updatedAt;// æ›´æ–°æ—¶é—´
    private Integer isDeleted;      // é€»è¾‘åˆ é™¤æ ‡è®°
}
```

### 2. DTOç±»

#### ScheduleDTO.java
æ—¥ç¨‹å“åº”å¯¹è±¡ï¼Œè¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼

#### CreateScheduleRequest.java
åˆ›å»ºæ—¥ç¨‹è¯·æ±‚å¯¹è±¡

#### UpdateScheduleRequest.java
æ›´æ–°æ—¥ç¨‹è¯·æ±‚å¯¹è±¡

### 3. Repositoryæ¥å£ (ScheduleRepository.java)

```java
@Repository
public interface ScheduleRepository extends JpaRepository<Schedule, String> {
    // æŸ¥è¯¢æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªæ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰æ—¥ç¨‹
    List<Schedule> findByUserIdAndDateRange(String userId, LocalDate startDate, LocalDate endDate);

    // æ ¹æ®æ—¥ç¨‹IDå’Œç”¨æˆ·IDæŸ¥æ‰¾æ—¥ç¨‹
    Optional<Schedule> findByScheduleIdAndUserIdAndIsDeleted(String scheduleId, String userId, Integer isDeleted);
}
```

### 4. ServiceæœåŠ¡ (ScheduleService.java)

æä¾›ä»¥ä¸‹ä¸šåŠ¡æ–¹æ³•ï¼š
- `getSchedulesByMonth()` - è·å–æŒ‡å®šæœˆä»½çš„æ‰€æœ‰æ—¥ç¨‹
- `createSchedule()` - åˆ›å»ºæ–°æ—¥ç¨‹
- `updateSchedule()` - æ›´æ–°æ—¥ç¨‹
- `deleteSchedule()` - åˆ é™¤æ—¥ç¨‹ï¼ˆé€»è¾‘åˆ é™¤ï¼‰

### 5. Controlleræ§åˆ¶å™¨ (ScheduleController.java)

æä¾›REST APIæ¥å£ï¼Œè¯¦è§ä¸‹æ–¹APIæ–‡æ¡£ã€‚

---

## ğŸ“¡ APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:8080/api`
- **è®¤è¯æ–¹å¼**: JWT Tokenï¼ˆæ‰€æœ‰æ¥å£å‡éœ€è¦ï¼‰
- **è¯·æ±‚å¤´**: `Authorization: Bearer {token}`

---

### 1. è·å–æŒ‡å®šæœˆä»½çš„æ—¥ç¨‹

**æ¥å£**: `GET /api/schedules`

**Queryå‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| year | Integer | âœ… | å¹´ä»½ï¼Œå¦‚ 2024 |
| month | Integer | âœ… | æœˆä»½ï¼Œ1-12 |

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X GET "http://localhost:8080/api/schedules?year=2024&month=7" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "scheduleId": "550e8400-e29b-41d4-a716-446655440000",
      "userId": "d60347da-da6f-4d3e-8adc-0bcdbba53692",
      "title": "å›¢é˜Ÿä¼šè®®",
      "scheduleDate": "2024-07-15",
      "startTime": "14:00",
      "endTime": "15:30",
      "location": "ä¼šè®®å®¤A",
      "isAllDay": false,
      "createdAt": 1720012800000
    },
    {
      "scheduleId": "660e8400-e29b-41d4-a716-446655440001",
      "userId": "d60347da-da6f-4d3e-8adc-0bcdbba53692",
      "title": "å…¬å¸å¹´ä¼š",
      "scheduleDate": "2024-07-20",
      "startTime": null,
      "endTime": null,
      "location": "é…’åº—å¤§å…",
      "isAllDay": true,
      "createdAt": 1720099200000
    }
  ]
}
```

---

### 2. åˆ›å»ºæ–°æ—¥ç¨‹

**æ¥å£**: `POST /api/schedules`

**Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| title | String | âœ… | æ—¥ç¨‹æ ‡é¢˜ |
| scheduleDate | String | âœ… | æ—¥ç¨‹æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD |
| startTime | String | âŒ | å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼ï¼šHH:mm |
| endTime | String | âŒ | ç»“æŸæ—¶é—´ï¼Œæ ¼å¼ï¼šHH:mm |
| location | String | âŒ | æ—¥ç¨‹åœ°ç‚¹ |
| isAllDay | Boolean | âœ… | æ˜¯å¦å…¨å¤© |

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8080/api/schedules \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..." \
  -d '{
    "title": "å®¢æˆ·ä¼šè®®",
    "scheduleDate": "2024-07-18",
    "startTime": "10:00",
    "endTime": "11:30",
    "location": "å®¢æˆ·å…¬å¸",
    "isAllDay": false
  }'
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "scheduleId": "770e8400-e29b-41d4-a716-446655440002",
    "userId": "d60347da-da6f-4d3e-8adc-0bcdbba53692",
    "title": "å®¢æˆ·ä¼šè®®",
    "scheduleDate": "2024-07-18",
    "startTime": "10:00",
    "endTime": "11:30",
    "location": "å®¢æˆ·å…¬å¸",
    "isAllDay": false,
    "createdAt": 1720185600000
  }
}
```

---

### 3. æ›´æ–°æ—¥ç¨‹

**æ¥å£**: `PUT /api/schedules/{scheduleId}`

**Pathå‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| scheduleId | String | âœ… | æ—¥ç¨‹ID |

**è¯·æ±‚å‚æ•°**: åŒåˆ›å»ºæ—¥ç¨‹

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X PUT http://localhost:8080/api/schedules/770e8400-e29b-41d4-a716-446655440002 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..." \
  -d '{
    "title": "é‡è¦å®¢æˆ·ä¼šè®®",
    "scheduleDate": "2024-07-18",
    "startTime": "14:00",
    "endTime": "16:00",
    "location": "å®¢æˆ·å…¬å¸ï¼ˆæ›´æ”¹ï¼‰",
    "isAllDay": false
  }'
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "scheduleId": "770e8400-e29b-41d4-a716-446655440002",
    "userId": "d60347da-da6f-4d3e-8adc-0bcdbba53692",
    "title": "é‡è¦å®¢æˆ·ä¼šè®®",
    "scheduleDate": "2024-07-18",
    "startTime": "14:00",
    "endTime": "16:00",
    "location": "å®¢æˆ·å…¬å¸ï¼ˆæ›´æ”¹ï¼‰",
    "isAllDay": false,
    "createdAt": 1720185600000
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": 404,
  "message": "æ—¥ç¨‹ä¸å­˜åœ¨",
  "data": null
}
```

---

### 4. åˆ é™¤æ—¥ç¨‹

**æ¥å£**: `DELETE /api/schedules/{scheduleId}`

**Pathå‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| scheduleId | String | âœ… | æ—¥ç¨‹ID |

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X DELETE http://localhost:8080/api/schedules/770e8400-e29b-41d4-a716-446655440002 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": 404,
  "message": "æ—¥ç¨‹ä¸å­˜åœ¨",
  "data": null
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. åˆå§‹åŒ–æ•°æ®åº“

æ‰§è¡Œæ•°æ®åº“è„šæœ¬åˆ›å»ºæ—¥ç¨‹è¡¨ï¼š

```bash
mysql -u root -p speed_calendar < database_init.sql
```

æˆ–è€…åœ¨MySQLå®¢æˆ·ç«¯ä¸­æ‰§è¡Œï¼š

```sql
USE speed_calendar;
SOURCE /path/to/database_init.sql;
```

### 2. éªŒè¯è¡¨åˆ›å»º

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
SHOW CREATE TABLE schedules;

-- æŸ¥çœ‹ç´¢å¼•
SHOW INDEX FROM schedules;

-- æµ‹è¯•æŸ¥è¯¢
SELECT * FROM schedules WHERE is_deleted = 0;
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd SpeedCalendar-server
mvn clean install
mvn spring-boot:run
```

### 4. æµ‹è¯•æ¥å£

ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•APIæ¥å£ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ã€‚

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹ï¼ˆJavaScript/TypeScriptï¼‰

```javascript
// APIé…ç½®
const API_BASE_URL = 'http://localhost:8080/api';
const token = localStorage.getItem('accessToken');

// 1. è·å–2024å¹´7æœˆçš„æ‰€æœ‰æ—¥ç¨‹
async function getSchedules(year, month) {
  const response = await fetch(
    `${API_BASE_URL}/schedules?year=${year}&month=${month}`,
    {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    }
  );
  const result = await response.json();
  return result.data;
}

// 2. åˆ›å»ºæ–°æ—¥ç¨‹
async function createSchedule(scheduleData) {
  const response = await fetch(
    `${API_BASE_URL}/schedules`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(scheduleData)
    }
  );
  const result = await response.json();
  return result.data;
}

// 3. æ›´æ–°æ—¥ç¨‹
async function updateSchedule(scheduleId, scheduleData) {
  const response = await fetch(
    `${API_BASE_URL}/schedules/${scheduleId}`,
    {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(scheduleData)
    }
  );
  const result = await response.json();
  return result.data;
}

// 4. åˆ é™¤æ—¥ç¨‹
async function deleteSchedule(scheduleId) {
  const response = await fetch(
    `${API_BASE_URL}/schedules/${scheduleId}`,
    {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    }
  );
  const result = await response.json();
  return result;
}

// ä½¿ç”¨ç¤ºä¾‹
(async () => {
  // è·å–2024å¹´7æœˆçš„æ—¥ç¨‹
  const schedules = await getSchedules(2024, 7);
  console.log('æˆ‘çš„æ—¥ç¨‹:', schedules);

  // åˆ›å»ºæ–°æ—¥ç¨‹
  const newSchedule = await createSchedule({
    title: 'å›¢é˜Ÿä¼šè®®',
    scheduleDate: '2024-07-15',
    startTime: '14:00',
    endTime: '15:00',
    location: 'ä¼šè®®å®¤',
    isAllDay: false
  });
  console.log('åˆ›å»ºæˆåŠŸ:', newSchedule);

  // æ›´æ–°æ—¥ç¨‹
  const updated = await updateSchedule(newSchedule.scheduleId, {
    title: 'é‡è¦å›¢é˜Ÿä¼šè®®',
    scheduleDate: '2024-07-15',
    startTime: '15:00',
    endTime: '16:00',
    location: 'å¤§ä¼šè®®å®¤',
    isAllDay: false
  });
  console.log('æ›´æ–°æˆåŠŸ:', updated);

  // åˆ é™¤æ—¥ç¨‹
  await deleteSchedule(newSchedule.scheduleId);
  console.log('åˆ é™¤æˆåŠŸ');
})();
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®éªŒè¯
- **æ—¥æœŸæ ¼å¼**: å¿…é¡»ä¸º `YYYY-MM-DD` æ ¼å¼
- **æ—¶é—´æ ¼å¼**: å¿…é¡»ä¸º `HH:mm` æ ¼å¼ï¼ˆ24å°æ—¶åˆ¶ï¼‰
- **å…¨å¤©æ—¥ç¨‹**: å½“ `isAllDay` ä¸º `true` æ—¶ï¼Œ`startTime` å’Œ `endTime` å¯ä»¥ä¸ºç©º

### 2. æƒé™æ§åˆ¶
- æ‰€æœ‰æ¥å£éƒ½éœ€è¦JWTè®¤è¯
- ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ—¥ç¨‹
- æ—¥ç¨‹IDå’Œç”¨æˆ·IDåŒæ—¶éªŒè¯ï¼Œé˜²æ­¢è¶Šæƒè®¿é—®

### 3. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨äº†å¤åˆç´¢å¼• `(user_id, schedule_date)` ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- æŸ¥è¯¢æ—¶æŒ‰æ—¥æœŸå’Œæ—¶é—´æ’åºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- ä½¿ç”¨é€»è¾‘åˆ é™¤ï¼Œå¯ä»¥å®ç°æ—¥ç¨‹æ¢å¤åŠŸèƒ½

### 4. é”™è¯¯å¤„ç†
- æ—¥ç¨‹ä¸å­˜åœ¨æ—¶è¿”å›404é”™è¯¯
- æ—¥æœŸæ—¶é—´æ ¼å¼é”™è¯¯ä¼šæŠ›å‡ºå¼‚å¸¸
- æœªæˆæƒè®¿é—®è¿”å›401é”™è¯¯

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### æ•°æ®åº“è„šæœ¬
- `database_init.sql` - å®Œæ•´æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼ˆåŒ…å«æ—¥ç¨‹è¡¨ï¼‰
- `schedules_table.sql` - å•ç‹¬çš„æ—¥ç¨‹è¡¨å»ºè¡¨è„šæœ¬

### åç«¯ä»£ç 
- **å®ä½“ç±»**: `entity/Schedule.java`
- **DTOç±»**:
  - `dto/ScheduleDTO.java`
  - `dto/CreateScheduleRequest.java`
  - `dto/UpdateScheduleRequest.java`
- **Repository**: `repository/ScheduleRepository.java`
- **Service**: `service/ScheduleService.java`
- **Controller**: `controller/ScheduleController.java`

---

## ğŸ¯ åç»­æ‰©å±•å»ºè®®

1. **æ—¥ç¨‹æé†’åŠŸèƒ½**
   - æ·»åŠ æé†’æ—¶é—´å­—æ®µ
   - å®ç°å®šæ—¶ä»»åŠ¡æ¨é€æé†’

2. **æ—¥ç¨‹åˆ†ç±»**
   - æ·»åŠ åˆ†ç±»å­—æ®µï¼ˆå·¥ä½œã€ç”Ÿæ´»ã€å­¦ä¹ ç­‰ï¼‰
   - æ”¯æŒè‡ªå®šä¹‰åˆ†ç±»

3. **æ—¥ç¨‹å…±äº«**
   - æ”¯æŒå°†æ—¥ç¨‹åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·
   - æ·»åŠ æ—¥ç¨‹å‚ä¸è€…è¡¨

4. **é‡å¤æ—¥ç¨‹**
   - æ”¯æŒæ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆé‡å¤
   - æ·»åŠ é‡å¤è§„åˆ™å­—æ®µ

5. **æ—¥ç¨‹æœç´¢**
   - æŒ‰æ ‡é¢˜ã€åœ°ç‚¹æœç´¢
   - å…¨æ–‡æœç´¢åŠŸèƒ½

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-11-26
**ç‰ˆæœ¬**: v1.0
**ä½œè€…**: SpeedCalendar Team
