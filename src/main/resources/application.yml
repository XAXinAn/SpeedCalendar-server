# =============================================
# SpeedCalendar 应用配置（公共配置）
# 环境专用配置请参见:
#   - application-dev.yml  (开发环境)
#   - application-prod.yml (生产环境)
# =============================================

spring:
  application:
    name: SpeedCalendar-server

  # 默认激活开发环境，生产部署时通过环境变量或JVM参数覆盖
  # 例如: java -Dspring.profiles.active=prod -jar xxx.jar
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # 数据源配置（公共部分，具体值由 profile 文件覆盖）
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # JPA配置（公共部分）
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect

  # Redis配置（公共部分）
  data:
    redis:
      database: 0
      timeout: 3000ms
      lettuce:
        pool:
          max-wait: -1ms

  # Jackson配置
  jackson:
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false

  # 文件上传配置
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB

# =============================================
# LangChain4j AI 配置 (硅基流动 API)
# =============================================
langchain4j:
  open-ai:
    chat-model:
      base-url: https://api.siliconflow.cn/v1
      model-name: Qwen/Qwen3-Next-80B-A3B-Instruct
      timeout: PT2M

# 服务器配置
server:
  port: 8080
  address: 0.0.0.0 # 绑定到所有网络接口，允许外部访问
  servlet:
    context-path: /api
  tomcat:
    uri-encoding: UTF-8
    max-connections: 10000
    threads:
      max: 200
      min-spare: 10

# JWT配置（公共部分，密钥由 profile 文件或环境变量覆盖）
jwt:
  secret: ${JWT_SECRET:SpeedCalendar-JWT-Secret-Key-2025-Change-This-In-Production}
  access-token-expiration: 7200      # 访问令牌有效期（秒）：2小时
  refresh-token-expiration: 2592000  # 刷新令牌有效期（秒）：30天

# 验证码配置
verification:
  code:
    length: 6          # 验证码长度
    expiration: 300    # 验证码有效期（秒）：5分钟
    daily-limit: 10    # 每个手机号每天发送次数限制
    interval: 60       # 发送间隔（秒）：1分钟
    debug-mode: true   # 本地调试模式：true-控制台打印验证码, false-实际发送短信

# 文件存储配置（公共部分）
file:
  avatar:
    max-size: 5242880  # 最大文件大小（字节）：5MB
    allowed-types: jpg,jpeg,png,webp
    allowed-mime-types: image/jpeg,image/png,image/webp
  storage:
    compression:
      enabled: true          # 是否启用图片压缩
      max-width: 800         # 最大宽度（像素）
      max-height: 800        # 最大高度（像素）
      quality: 0.85          # 压缩质量 (0.0-1.0)
      output-format: jpg     # 输出格式

# 日志配置（公共部分）
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/speedcalendar.log
    max-size: 10MB
    max-history: 30
