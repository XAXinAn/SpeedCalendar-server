# 📊 数据统计与增强查询接口文档 (V1.3)

本文档旨在为前端提供“数据统计”页面的接口规范，包含饼状图、趋势图以及优化后的查询接口。

## 1. 基础信息

*   **Base Path**: `/api`
*   **认证方式**: Header 中携带 `Authorization: Bearer {token}`
*   **时间标准**: 服务器返回的 ISO8601 时间字符串（如 `2024-11-20T14:30:00+08:00`）包含时区信息，前端可直接使用 `DateTime.parse()`。

---

## 2. 统计接口 (Stats)

### 2.1 分类占比统计 (饼状图)
用于统计指定月份内，各分类日程的数量分布。

*   **接口地址**: `/stats/categories`
*   **方法**: `GET`
*   **请求参数**:
    | 参数名 | 类型 | 必填 | 说明 | 示例 |
    | :--- | :--- | :--- | :--- | :--- |
    | **`month`** | String | 是 | 格式 `YYYY-MM` | `2024-11` |

*   **响应示例**:
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    { "category": "工作", "count": 12, "color": "#2196F3" },
    { "category": "学习", "count": 8, "color": "#4CAF50" },
    { "category": "生活", "count": 5, "color": "#9C27B0" },
    { "category": "其他", "count": 3, "color": "#9E9E9E" }
  ]
}
```
*   **说明**: 
    1. 包含用户个人及所属群组的日程。
    2. `color` 为后端根据该分类下最近日程定义的颜色。
    3. 如果某月无数据，`data` 返回空数组 `[]`。

### 2.2 周度活跃趋势 (趋势图)
统计以指定日期为中心的共 8 周（前 4 周 + 当前周 + 后 3 周）的日程数量。

*   **接口地址**: `/stats/weekly-trends`
*   **方法**: `GET`
*   **请求参数**:
    | 参数名 | 类型 | 必填 | 说明 | 示例 |
    | :--- | :--- | :--- | :--- | :--- |
    | **`currentDate`** | String | 是 | 格式 `YYYY-MM-DD` | `2024-11-20` |

*   **响应示例**:
```json
{
  "code": 200,
  "data": [
    { "weekLabel": "10/21", "weekRange": "10.21-10.27", "count": 15 },
    { "weekLabel": "10/28", "weekRange": "10.28-11.03", "count": 10 },
    { "weekLabel": "11/04", "weekRange": "11.04-11.10", "count": 22 },
    { "weekLabel": "11/11", "weekRange": "11.11-11.17", "count": 18 },
    { "weekLabel": "11/18", "weekRange": "11.18-11.24", "count": 25 }, 
    { "weekLabel": "11/25", "weekRange": "11.25-12.01", "count": 12 },
    { "weekLabel": "12/02", "weekRange": "12.02-12.08", "count": 7 },
    { "weekLabel": "12/09", "weekRange": "12.09-12.15", "count": 5 }
  ]
}
```
*   **说明**: 
    1. **周起点**: 严格按照周一(Monday)作为每周的第一天。
    2. **weekLabel**: 建议用于条形图的 X 轴标签。
    3. **weekRange**: 用于 Tips 显示完整日期范围。

---

## 3. 增强查询接口 (Schedules)

### 3.1 时间范围获取日程
用于一次性加载长周期（如 8 周）的日程明细，避免多次请求“按天获取”接口。

*   **接口地址**: `/schedules/range`
*   **方法**: `GET`
*   **请求参数**:
    | 参数名 | 类型 | 必填 | 说明 | 示例 |
    | :--- | :--- | :--- | :--- | :--- |
    | **`startDate`** | String | 是 | 格式 `YYYY-MM-DD` | `2024-10-01` |
    | **`endDate`** | String | 是 | 格式 `YYYY-MM-DD` | `2024-11-30` |

*   **响应示例**: 同基础日程列表，返回 `List<ScheduleDTO>`。

### 3.2 临近日程获取 (Nearby)
获取当前时间点前后的紧急日程。

*   **接口地址**: `/schedules/nearby`
*   **方法**: `GET`
*   **逻辑说明**: 后端自动计算 `[Now - 3h, Now + 24h]` 范围内的日程。
*   **应用场景**: 首页“今日剩余”或“临近提醒”卡片。

---

## 4. 关键数据结构说明 (ScheduleDTO)

V1.3 版本后，每个日程对象新增了带有时区的 ISO 时间字段：

| 字段名 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| **`startDateTime`** | String | ISO8601 开始时间 | `2024-11-20T14:30:00+08:00` |
| **`endDateTime`** | String | ISO8601 结束时间 | `2024-11-20T15:30:00+08:00` |

**提示**: 前端展示时，如果 `isAllDay` 为 `true`，请忽略具体时间，仅显示日期。
